<!DOCTYPE html>
<html>
<head>
  <title>FCM 1.3 Release Notes</title>
  <meta name="author" content="FCM team" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="../etc/fcm-icon.png" type="image/png" />
  <link rel="shortcut icon" href="../etc/fcm-icon.png" type="image/png" />
  <link href="../etc/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />
  <link href="../etc/fcm.css" rel="stylesheet" media="screen" />
</head>
<body>
  <div class="navbar navbar-inverse">
    <div class="navbar-inner">
      <a class="brand" href=".."><span class="fcm-version">FCM</span></a>
      <ul class="nav">
        <li><a href="../installation/">Installation</a></li>

        <li><a href="../user_guide/">User Guide</a></li>
      </ul>
    </div>
  </div>

  <div class="page-header">
    <div class="fcm-page-content pull-right well well-small"></div>
    <h1>FCM 1.3 Release Notes <small>30 January 2008</small></h1>
  </div>

  <div class="container">
  <div class="row">
  <div class="span12">

  <p>These are the release notes for FCM release 1.3. You can use this release
  of FCM freely under the terms of the FCM LICENSE, which you should receive
  with the distribution of this release.</p>

  <p>Note that FCM now requires Subversion 1.4.0 or later (previous releases
  only required Subversion 1.2.0).</p>

  <p>FCM is maintained by the FCM team at the Met Office. Please feedback any
  bug reports or feature requests to us by <a href=
  "mailto:fcm-team@metoffice.gov.uk">e-mail</a>.</p>

  <h2 id="new">What's New?</h2>

  <p>Build and extract:</p>

  <ul>
    <li>The syntax for declaring the extract/build destinations are unified.
    The <code>DEST</code> (or <code>DEST::ROOTDIR</code>) declaration should be
    used to declare the root of the extract/build destination. The
    <code>DIR::ROOT</code> declaration is deprecated.</li>

    <li>Users can no longer declare sub-directories in a destination.
    Declarations such as <code>DEST::CFGDIR</code>, <code>DEST::SRCDIR</code>,
    etc are no longer supported.</li>

    <li>In configuration files, words or fields in a <em>label</em> can now be
    delimited by a slash (<code>/</code>) as well as a double colon
    (<code>::</code>). To improve readability, the convention is to only use
    slash as the delimiter when referring to package names.</li>

    <li>In a <code>true</code> or <code>false</code> declaration in a
    configuration file, the system will now accept the following values as
    false: <samp>0</samp>, <samp>&lt;empty string&gt;</samp>,
    <samp>false</samp>, <samp>no</samp> and <samp>off</samp>. (It used to
    accept <samp>&lt;any non empty string&gt;</samp> for <code>true</code> and
    <samp>0</samp>, or <samp>&lt;empty string&gt;</samp> for
    <code>false</code>.)</li>

    <li>The build and extract caches are now located separately in
    <samp>.cache/.bld/</samp> and <samp>.cache/.ext/</samp> respectively. In
    most cases they will be upgraded automatically when you perform the next
    incremental build/extract. However, if you use inherited build/extract, you
    must upgrade the inherited build/extract before they can be used. To
    upgrade an inherited extract, issue the following commands:
      <pre>
cd /path/to/inherited/extract/
cd .cache/
mkdir .ext/
cp -r -p .config * .ext/
</pre>

      <p>To upgrade an inherited build, issue the following commands:</p>
      <pre>
cd /path/to/inherited/build/
fcm bld
</pre>
    </li>

    <li>Extra/common stages in the build/extract processes: <em>parse
    configuration</em> and <em>set up destination</em>.</li>

    <li>The build/extract destination (and the remote destination for extract)
    will now be printed in verbose mode 1 or above.</li>

    <li>A new command line option <code>--clean</code> for removing files
    generated by previous extracts/builds.</li>

    <li>An as-parsed configuration file will be generated for each run (if the
    file differs from the previous run).</li>
  </ul>

  <p>Build:</p>

  <ul>
    <li>It is now more efficient to make <code>SRC</code> declarations for
    files instead of the container directories. Container directories can still
    be declared, but they will be expanded by the configuration file parser
    into a list of source files within it. In addition, <code>SRC</code>
    declarations no longer require the specification of package names - if it
    is a relative path of the src/ sub-directory. If a relative path is
    specified, it will be assumed a relative path of the src/
    sub-directory.</li>

    <li>For declarations such as <code>EXCL_DEP, PP, TOOL</code>, if a package
    name is associated with the declaration, the system will fail if the
    package is not declared or defined.</li>

    <li>The system will now detect changes in <code>EXCL_DEP, INFILE_EXT and
    OUTFILE_EXT</code> declarations in an incremental build.</li>

    <li>It is now possible to make PP declarations down to the file level.
    (Previously, it could only be done down to the level of the container
    directories.)</li>

    <li>The package name for a file used to be its root name (i.e. its basename
    without the extension). It is now its basename, (although the system will
    continue to support declarations down to the file's root name).</li>

    <li>The declarations <code>TYPE</code> and <code>DEP</code> can now be used
    to define the type and dependencies of a source file. (This replaces most
    functionalities of the package configuration file.)</li>

    <li>The build package configuration file is no longer supported.</li>

    <li>The system now generates a single <samp>Makefile</samp> in the root
    location of the destination. Hard coded directories should appear only once
    at the top of the Makefile, provided that source files are only located in
    the <samp>src/</samp> sub-directory of the build destination. (A build used
    to have a top level <samp>Makefile</samp>, which included a
    <samp>*.mk</samp> file for each source directory in the <samp>bld/</samp>
    sub-directory of the destination.)</li>

    <li>The <samp>fcm_env.ksh</samp> file is renamed <samp>fcm_env.sh</samp>,
    which should work with the Bourne shell. (<samp>fcm_env.ksh</samp> is still
    available via a symbolic link but is deprecated.)</li>

    <li>The <code>--archive</code> or <code>-a</code> option will now archive
    your build directories using the command <code>tar -czf FILE DIR</code>.
    Consequently, the system will dearchive them using <code>tar -xzf
    FILE</code>. If you have been using this option in your previous builds,
    you should extract the archives manually using <code>tar -xf FILE</code>
    before running <code>fcm build</code> in incremental mode. Remove the old
    TAR files on success.</li>

    <li>The linker command now defaults to the compiler of the language of the
    program source file. (The default used to be <code>ld</code>.)</li>
  </ul>

  <p>Code management commands:</p>

  <ul>
    <li>Allow other graphical merge tools to be used in place of
    <em>xxdiff</em> by modifying <code>bin/fcm_graphic_merge</code>.</li>

    <li><code>fcm commit</code> will issue extra warning when a user attempts
    to commit to or remove a branch belonging to another user.</li>

    <li>The system has been modified to account for the improved support for
    peg revisions using the <code>svn log</code> command in Subversion 1.4.
    Unfortunately this means that Subversion 1.4.x clients are now
    required.</li>

    <li><code>fcm diff</code> now supports the <code>--summarize</code> option
    which was introduced in Subversion 1.4.</li>

    <li>Added alternate branching strategy in the <a href=
    "../collaboration/">External Distribution &amp; Collaboration for FCM
    Projects</a> document.</li>

    <li>A number of limitations with the <code>fcm mkpatch</code> command have
    been fixed. It will also use unified diffs where possible in order to
    reduce the size of the patch and to make it more readable.</li>
  </ul>

  <p>Extract:</p>

  <ul>
    <li>The <code>ROOTDIR</code> part of the <code>RDEST::ROOTDIR</code>
    declaration is now optional.</li>

    <li>The <code>MIRROR</code> declaration is deprecated, and replaced by the
    <code>RDEST::MIRROR_CMD</code> declaration.</li>

    <li>The build configuration file generated by extract should no longer
    contain hard coded paths - except for <code>USE</code> declarations and
    those protected by the <code>BLD</code> prefix.</li>

    <li>The <code>VERSION</code> declaration is deprecated, and replaced by the
    <code>REVISION</code> declaration.</li>

    <li>Added a new <code>REVMATCH</code> declaration for the extract
    configuration file. If you specify a revision (other than HEAD) for a
    branch, and this revision is not associated with a changeset for this
    branch, the system will normally inform you of this discrepancy. By setting
    <code>REVMATCH</code> to "true", however, the discrepancy will cause
    extract to fail.</li>

    <li>Extract used to fail if the same file is modified by two different
    branches (compared with the base branch). It now attempts to merge the
    changes using <code>diff3 -E -m</code>. It only fails if there are
    unresolved conflicts.</li>

    <li>Consequently, the <code>OVERRIDE</code> declaration is deprecated, and
    replaced by the <code>CONFLICT</code> declaration, which can be set to
    <samp>fail</samp>, <samp>merge</samp> (default) or
    <samp>override</samp>.</li>
  </ul>

  <h2 id="fix">Minor enhancements &amp; Bug Fixes</h2>

  <p>Build:</p>

  <ul>
    <li>If there is no source file to build, report an error at the beginning
    of the build process.</li>
  </ul>

  <p>Code management commands:</p>

  <ul>
    <li>Fixed: FCM URL keyword not expanded when it is specified with an equal
    sign in an option.</li>

    <li>Fixed: typo in the output of <code>fcm branch --info</code>.</li>
  </ul>

  <p>Extract:</p>

  <ul>
    <li>Improved logic for better performance.</li>

    <li>Allow mirroring to use <code>rsync</code> with an alternate remote
    shell.</li>

    <li><code>fcm cmp-ext-cfg</code>: Improved support for <a href=
    "http://trac.edgewall.org/wiki/InterTrac">InterTrac</a> links.</li>
  </ul>

  <p>General:</p>

  <ul>
    <li>Fixed: problems parsing Subversion peg revision with the FCM URL
    keywords.</li>

    <li>The general shell used by FCM is changed from <code>/usr/bin/ksh</code>
    to <code>/bin/sh</code> to improve portability.</li>

    <li>Various other very minor enhancements and bug fixes.</li>
  </ul>

  <h2 id="issues">Known Issues</h2>

  <p>The following are known issues with this release of FCM which we plan to
  address in later releases:</p>

  <ul>
    <li>FCM build does not handle changes in an include file correctly in an
    inherited build if the include file resides in the same directory as the
    source file including it, and the source file remains unchanged. This is
    due to the fact that most pre-processor/compiler commands search the
    directory containing the source file for include files first before they
    search elsewhere. We are hoping to find a solution to this problem before
    the next release.</li>
  </ul>

  <h2 id="req">System Requirements</h2>

  <h3 id="req_perl">Perl</h3>

  <p>The core part of FCM is a set of Perl scripts and modules. For the build
  system to work, you need the following modules installed:</p>

  <ul>
    <li>Carp</li>

    <li>Cwd</li>

    <li>File::Basename</li>

    <li>File::Compare</li>

    <li>File::Find</li>

    <li>File::Path</li>

    <li>File::Spec::Functions</li>

    <li>File::Spec</li>

    <li>FindBin</li>

    <li>Getopt::Long</li>

    <li>POSIX</li>
  </ul>

  <p>The code management commands and extract system need the following
  additional modules installed:</p>

  <ul>
    <li>File::Temp</li>

    <li>Getopt::Long</li>

    <li>HTTP::Date</li>

    <li>XML::DOM</li>
  </ul>

  <p>To use the simple GUI for some of the code management commands, you also
  need the following modules:</p>

  <ul>
    <li>Tk::ROText</li>

    <li>Tk</li>
  </ul>

  <p>At the Met Office we are currently using the complete FCM system with Perl
  5.8.x. In addition the build system is being used with Perl 5.6.x.</p>

  <h3 id="req_svn">Subversion</h3>

  <p>To use the code management commands (and relevant parts of the extract
  system) you need to have <a href=
  "http://subversion.tigris.org/">Subversion</a> installed.</p>

  <ul>
    <li>FCM makes extensive use of peg revisions in both the code management
    and extract systems. This requires Subversion 1.4.0.</li>

    <li>At the Met Office we are currently using Subversion 1.4.3.</li>
  </ul>

  <p>Note that the extract system can mirror extracted code to a remote
  platform for building. Therefore it is only necessary to have Subversion
  installed on the platform where you do your code development. If you use
  other platforms purely for building and running then you do not need to have
  Subversion installed on these platforms.</p>

  <h3 id="req_trac">Trac</h3>

  <p>The use of <a href="http://trac.edgewall.org/">Trac</a> is entirely
  optional (although highly recommended if you are using Subversion).</p>

  <ul>
    <li>The <code>--trac</code> and <code>--wiki</code> options to the
    <code>fcm diff --branch</code> command allow you to view branch differences
    using Trac. This requires Trac 0.10.</li>

    <li>At the Met Office we are currently using Trac 0.10.3.</li>
  </ul>

  <h3 id="req_other">Other Requirements</h3>

  <p>The <code>fcm conflicts</code> command requires <a href=
  "http://furius.ca/xxdiff/">xxdiff</a>. At the Met Office we are currently
  using version 3.1. The <code>fcm diff --graphical</code> command also uses
  xxdiff by default although other graphical diff tools can also be used.</p>

  <p>The extract system can use diff3, which is part of <a href=
  "http://www.gnu.org/software/diffutils/">GNU diffutils</a>, to merge together
  changes where the same file is modified by two different branches (compared
  with the base branch). At the Met Office we are currently using version
  2.8.1.</p>

  <p>The build system requires <a href=
  "http://www.gnu.org/software/make/make.html">GNU make</a>. At the Met Office
  we are currently using version 3.79.x and 3.80.</p>

  <p>Optionally, the build system can use <a href=
  "http://www.ifremer.fr/ditigo/molagnon/fortran90/">f90aib</a> to generate
  interface files. However, there is also a built in Perl based interface file
  generator which is quicker and better in most cases so you are unlikely to
  need f90aib unless you hit a problem with some particular code.</p>

  <p>FCM is intended to run on a Unix/Linux system. It is currently used at the
  Met Office on Linux (Red Hat Enterprise 2.1 and 4.5) and HP-UX 11.00.</p>

  <h2 id="ins">Installation</h2>

  <p>FCM is distributed in the form of a compressed tar file. Un-pack the tar
  file into an appropriate location on your system. Then add the
  <samp>bin/</samp> directory into your <var>PATH</var>. Once you have done
  this you should now have full access to the FCM system, assuming that you
  have met the requirements described in the previous section.</p>

  <p>If you wish to define keywords for your systems you will need to create a
  file <samp>etc/fcm.cfg</samp>. An example file, <samp>fcm.cfg.eg</samp>, is
  provided which is a copy of the file currently used at the Met Office. For
  further details please refer to the section <a href=
  "../user_guide/system_admin.html#fcm-keywords">FCM keywords</a> in the System
  Admin chapter of the User Guide.</p>

  <p>The <samp>doc/</samp> directory contains all the system documentation.</p>

  <ul>
    <li><samp>doc/release_notes/</samp> contains these release notes. It also
    contains the release notes for all previous versions which may be useful if
    you have skipped any versions.</li>

    <li><samp>doc/user_guide/</samp> contains the <a href="../user_guide/">FCM
    User Guide</a>.</li>

    <li><samp>doc/design/</samp> contains the <a href="../design/">FCM Detailed
    Design</a> document (currently in draft form).</li>

    <li><samp>doc/standards/</samp> contains the FCM <a href=
    "../standards/perl_standard.html">Perl</a> and <a href=
    "../standards/fortran_standard.html">Fortran</a> coding standards. The Perl
    standard describes the standards followed by the FCM code. The Fortran
    standard contains some <a href=
    "../standards/fortran_standard.html#fcm">specific advice</a> on the best
    way of writing Fortran code for use with FCM as well as more general advice
    on good practise.</li>

    <li><samp>doc/collaboration/</samp> contains the <a href=
    "../collaboration/index.html">External Distribution &amp; Collaboration for
    FCM Projects</a> document which discusses how projects configured under FCM
    can be distributed externally.</li>
  </ul>

  <p>The <samp>tutorial/</samp> directory contains the files necessary to set
  up a tutorial repository. This will allow you to follow the <a href=
  "../user_guide/getting_started.html#tutorial">tutorial section</a> in the
  User Guide.</p>

  <ul>
    <li>The file <samp>tutorial/repos/tutorial.dump</samp> should be loaded
    into an empty repository using the <code>svnadmin load</code> command.</li>

    <li>The hook scripts in <samp>tutorial/hook/</samp> should then be
    installed in this repository in order to prevent any commits to the trunk.
    Note that the configuration file <samp>svnperms.conf</samp> assumes that
    the tutorial repository is called <samp>tutorial_svn</samp>. Please edit
    this file if you use a different name. You also need to install the
    Subversion utility <code>svnperms.py</code> in order for this to work.</li>

    <li>The repository should be configured to allow users write access. You
    may find it easiest to simply allow anonymous access.</li>

    <li>A Trac system should be configured associated with the Tutorial
    repository. You then need to allow users write access. You may find it
    easiest to set up a number of guest accounts for this purpose.</li>
  </ul>

  <p>The <samp>templates/</samp> directory contains various example scripts
  which you may find useful. Note that these scripts are all specific to the
  Met Office and may contain hard coded paths and email addresses. They are
  provided in the hope that you may find them useful as templates for setting
  up similar scripts of your own. However, they should only be used after
  careful review to adapt them to your environment. The contents are as
  follows:</p>

  <dl>
    <dt>templates/hook/pre-commit</dt>

    <dd>
      This script restricts write-access to the repository by checking the
      following:

      <ul>
        <li>It executes the Subversion utility <code>svnperms.py</code> if it,
        and the associated <code>svnperms.conf</code> file, exist. This utility
        checks whether the author of the current transaction has enough
        permission to write to particular paths in the repository.</li>

        <li>It checks the disk space required by the current transaction. It
        fails the commit if it requires more than 5Mb of disk space.</li>
      </ul>
    </dd>

    <dt>templates/hook/post-commit</dt>

    <dd>A simple post-commit hook script which runs the script
    <code>post-commit-background</code> in the background.</dd>

    <dt>templates/hook/post-commit-background</dt>

    <dd>
      This script runs in the background after each commit

      <ul>
        <li>It updates a <code>&lt;repos&gt;.latest</code> file with the latest
        revision number.</li>

        <li>It creates a dump of the new revision.</li>

        <li>It calls the script <code>background_updates.pl</code> if it
        exists.</li>
      </ul>This script is installed as standard in all our repositories.
    </dd>

    <dt>templates/hook/background_updates.pl</dt>

    <dd>An example of how you may want to set up a
    <code>background_updates.pl</code> script to perform post-commit tasks for
    a specific repository. This script uses a lock file to prevent multiple
    commits in quick succession from causing problems.</dd>

    <dt>templates/hook/pre-revprop-change</dt>

    <dd>A simple pre-revprop-change hook script which runs the script
    <code>pre-revprop-change.pl</code>.</dd>

    <dt>templates/hook/pre-revprop-change.pl</dt>

    <dd>If a user attempts to modify the log message of a changeset and he/she
    is not the original author of the changeset, this script will e-mail the
    original author. You can also set up a watch facility to monitor changes of
    log messages that affect particular paths in the repository. For further
    details please refer to the section <a href=
    "../user_guide/system_admin.html#svn_watch">Watching changes in log
    messages</a> in the System Admin chapter of the User Guide.</dd>

    <dt>templates/hook/post-revprop-change</dt>

    <dd>A simple post-revprop-change hook script which runs the script
    <code>post-revprop-change.py</code>.</dd>

    <dt>templates/hook/post-revprop-change.py</dt>

    <dd>This hook script updates the Trac SQLite database following a
    successful change in the log message.</dd>

    <dt>templates/utils/cron_template.sh</dt>

    <dd>An example of how you might set up a cron job to make use of the
    <samp>&lt;repos&gt;.latest</samp> file.</dd>

    <dt>templates/utils/daily_cron</dt>

    <dd>The cron job which we run each night. It verifies and backs up each of
    our repositories, housekeeps the revision dumps created by
    <code>post-commit-background</code> and backs up each of our Trac systems.
    It also handles the distribution of FCM to various platforms at the Met
    Office.</dd>

    <dt>templates/utils/fcm_add_trac.pl</dt>

    <dd>This script sets up a new Trac system and applies some configuration
    options which we use by default at the Met Office.</dd>

    <dt>templates/utils/recover_svn.pl</dt>

    <dd>This script allows us to recover all of our Subversion repositories by
    using the nightly backups and the repository dumps.</dd>
  </dl>

  </div>
  </div>
  </div>

  <hr/>
  <div class="container-fluid text-center">
    <div class="row-fluid"><div class="span12">
    <address><small>
      &copy; British Crown Copyright 2006-15
      <a href="http://www.metoffice.gov.uk">Met Office</a>.
      See <a href="../etc/fcm-terms-of-use.html">Terms of Use</a>.<br />
      This document is released under the British <a href=
      "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
      "license">Open Government Licence</a>.<br />
    </small></address>
    </div></div>
  </div>

  <script type="text/javascript" src="../etc/jquery.min.js"></script>
  <script type="text/javascript" src="../etc/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="../etc/fcm.js"></script>
  <script type="text/javascript" src="../etc/fcm-version.js"></script>
</body>
</html>
